<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROS2 ƒ∞nteraktif Sim√ºlat√∂r - The Construct Style</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>ü§ñ ROS2 ƒ∞nteraktif Sim√ºlat√∂r</h1>
                <p>WASM &amp; ROS2 ile ger√ßek zamanlƒ± etkile≈üim</p>
            </div>
            <div class="header-meta">
                <span>WASM Runtime</span>
                <span>Canvas 2D</span>
                <span>ROS2 Automation</span>
                <button class="btn-small palette-trigger" onclick="openCommandPalette()">Komut Paleti ‚åòK</button>
            </div>
        </header>

        <div class="main-content">
            <!-- Left Panel: Tabbed Controls -->
            <div class="left-panel">
                <div class="tabbed-panel">
                    <div class="tab-header">
                        <button class="tab-btn active" data-tab="robots">Robotlar</button>
                        <button class="tab-btn" data-tab="topics">Topics &amp; Nodes</button>
                        <button class="tab-btn" data-tab="automation">Otomasyon</button>
                        <button class="tab-btn" data-tab="playbooks">Komut St√ºdyosu</button>
                        <button class="tab-btn" data-tab="ops">ROS Ops</button>
                    </div>

                    <div class="tab-content active" data-tab-content="robots">
                        <div class="panel-section">
                            <h2>ü§ñ Robot Kontrolleri</h2>
                            <div class="control-group">
                                <h3>Robot Ekle</h3>
                                <input type="text" id="robotName" placeholder="Robot ismi (√∂rn: turtle1)">
                                <select id="robotType">
                                    <option value="turtlebot">TurtleBot3</option>
                                    <option value="differential">Differential Drive</option>
                                    <option value="ackermann">Ackermann Drive</option>
                                </select>
                                <button onclick="addRobot()" class="btn-primary">Robot Ekle</button>
                            </div>

                            <div class="control-group">
                                <h3>Robot Hareket</h3>
                                <select id="controlRobot">
                                    <option value="">Robot Se√ß...</option>
                                </select>
                                <div class="velocity-control">
                                    <label>Linear Velocity (m/s):</label>
                                    <input type="range" id="linearVel" min="-100" max="100" value="0" step="5">
                                    <span id="linearVelValue">0</span>
                                </div>
                                <div class="velocity-control">
                                    <label>Angular Velocity (rad/s):</label>
                                    <input type="range" id="angularVel" min="-3" max="3" value="0" step="0.1">
                                    <span id="angularVelValue">0</span>
                                </div>
                                <div class="keyboard-controls">
                                    <p><strong>Klavye Kontrolleri:</strong></p>
                                    <div class="key-grid">
                                        <div></div>
                                        <button class="key-btn" onclick="setVelocity(50, 0)">‚Üë<br>W</button>
                                        <div></div>
                                        <button class="key-btn" onclick="setVelocity(0, 1)">‚Üê<br>A</button>
                                        <button class="key-btn" onclick="setVelocity(0, 0)">STOP<br>S</button>
                                        <button class="key-btn" onclick="setVelocity(0, -1)">‚Üí<br>D</button>
                                        <div></div>
                                        <button class="key-btn" onclick="setVelocity(-50, 0)">‚Üì<br>X</button>
                                        <div></div>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group">
                                <h3>Ortam &amp; Engeller</h3>
                                <select id="obstacleShape">
                                    <option value="rectangle">Dikd√∂rtgen</option>
                                    <option value="circle">Daire</option>
                                </select>
                                <button id="obstacleModeBtn" onclick="addObstacleMode()" class="btn-info">Canvas'a Tƒ±klayarak Ekle</button>
                                <button onclick="clearObstacles()" class="btn-danger">Engelleri Temizle</button>
                            </div>
                        </div>

                        <div class="panel-section stats">
                            <h3>üìä ƒ∞statistikler</h3>
                            <div class="stat-item"><span>Robotlar</span><strong id="robotCount">0</strong></div>
                            <div class="stat-item"><span>Topic'ler</span><strong id="topicCount">0</strong></div>
                            <div class="stat-item"><span>Node'lar</span><strong id="nodeCount">0</strong></div>
                            <div class="stat-item"><span>Mesajlar</span><strong id="messageCount">0</strong></div>
                            <div class="stat-item"><span>Engeller</span><strong id="obstacleCount">0</strong></div>
                            <div class="stat-item"><span>Otomasyon</span><strong id="automationCount">0</strong></div>
                            <div class="stat-item"><span>FPS</span><strong id="fpsValue">0</strong></div>
                        </div>
                    </div>

                    <div class="tab-content" data-tab-content="topics">
                        <div class="panel-section">
                            <h2>üß† ROS2 Node Y√∂netimi</h2>
                            <div class="control-group">
                                <h3>Node Ekle</h3>
                                <input type="text" id="nodeName" placeholder="√ñrn: teleop_panel">
                                <select id="nodeType">
                                    <option value="control">Control</option>
                                    <option value="sensor">Sensor</option>
                                    <option value="navigation">Navigation</option>
                                    <option value="compute">Compute</option>
                                </select>
                                <button onclick="addNode()" class="btn-primary">Node Olu≈ütur</button>
                            </div>
                            <div class="control-group">
                                <h3>Topic Baƒülantƒ±sƒ±</h3>
                                <select id="nodeConnect">
                                    <option value="">Node Se√ß...</option>
                                </select>
                                <select id="topicConnect">
                                    <option value="">Topic Se√ß...</option>
                                </select>
                                <select id="connectionType">
                                    <option value="publisher">Publisher</option>
                                    <option value="subscriber">Subscriber</option>
                                </select>
                                <button onclick="linkNodeTopic()" class="btn-success">Baƒüla</button>
                            </div>
                            <div class="control-group">
                                <h3>Aktif Node'lar</h3>
                                <ul id="nodeList" class="data-list"></ul>
                            </div>
                        </div>

                        <div class="panel-section">
                            <h2>üì° ROS2 Topics</h2>
                            <div class="control-group">
                                <h3>Topic Ekle</h3>
                                <input type="text" id="topicName" placeholder="/cmd_vel">
                                <select id="msgType">
                                    <option value="geometry_msgs/Twist">geometry_msgs/Twist</option>
                                    <option value="std_msgs/String">std_msgs/String</option>
                                    <option value="sensor_msgs/LaserScan">sensor_msgs/LaserScan</option>
                                    <option value="nav_msgs/Odometry">nav_msgs/Odometry</option>
                                </select>
                                <button onclick="addTopic()" class="btn-primary">Topic Ekle</button>
                            </div>

                            <div class="control-group">
                                <h3>Mesaj G√∂nder</h3>
                                <select id="sendTopic"></select>
                                <textarea id="messageData" rows="2" placeholder="Mesaj i√ßeriƒüi">Merhaba ROS2!</textarea>
                                <button onclick="sendMessage()" class="btn-success">G√∂nder</button>
                            </div>

                            <div class="control-group">
                                <h3>Topic √ñzeti</h3>
                                <ul id="topicList" class="data-list"></ul>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" data-tab-content="automation">
                        <div class="panel-section automation-panel">
                            <h2>üß† Komut Otomasyonu</h2>
                            <div class="control-group">
                                <h3>Yeni Kural</h3>
                                <input type="text" id="automationTopic" placeholder="/cmd_text">
                                <input type="text" id="automationTrigger" placeholder="√∂r: robo1 ileri">
                                <select id="automationMatch">
                                    <option value="contains">Mesaj tetikleyiciyi i√ßeriyor</option>
                                    <option value="prefix">Mesaj tetikleyici ile ba≈ülƒ±yor</option>
                                    <option value="exact">Mesaj tam e≈üle≈üiyor</option>
                                </select>
                                <select id="automationRobot">
                                    <option value="">Robot se√ß...</option>
                                </select>
                                <select id="automationAction">
                                    <option value="forward">ƒ∞leri</option>
                                    <option value="backward">Geri</option>
                                    <option value="left">Sola D√∂n</option>
                                    <option value="right">Saƒüa D√∂n</option>
                                    <option value="stop">Dur</option>
                                </select>
                                <button onclick="addAutomationRule()" class="btn-success">Kural Ekle</button>
                            </div>
                            <div class="control-group">
                                <h3>Aktif Kurallar</h3>
                                <ul id="automationList" class="data-list automation-list"></ul>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" data-tab-content="playbooks">
                        <div class="panel-section">
                            <h2>‚ö° Hƒ±zlƒ± Komut St√ºdyosu</h2>
                            <p class="muted">Robot se√ß, hazƒ±r ≈üablonu belirle, mesajƒ± otomatik g√∂nder.</p>
                            <div class="playbook-form">
                                <select id="playbookRobot">
                                    <option value="">Robot se√ß...</option>
                                </select>
                                <select id="playbookTemplate"></select>
                                <select id="playbookTopic">
                                    <option value="/cmd_text">/cmd_text</option>
                                </select>
                                <button onclick="sendPlaybookCommand()" class="btn-success">Mesajƒ± G√∂nder</button>
                            </div>
                        </div>
                        <div class="panel-section">
                            <h2>üéØ Robot Bazlƒ± Aksiyonlar</h2>
                            <div id="playbookGrid" class="playbook-grid"></div>
                        </div>
                    </div>

                    <div class="tab-content" data-tab-content="ops">
                        <div class="panel-section diag-panel">
                            <h2>ü©∫ ROS Diagnostics</h2>
                            <div class="diag-grid">
                                <div class="diag-card">
                                    <span>Topic Latency</span>
                                    <strong id="diagLatency">-- ms</strong>
                                    <small>Son 1s ortalamasƒ±</small>
                                </div>
                                <div class="diag-card">
                                    <span>Mesaj Throughput</span>
                                    <strong id="diagThroughput">-- msg/s</strong>
                                    <small>Sim√ºlasyon mesajlarƒ±</small>
                                </div>
                                <div class="diag-card">
                                    <span>Sistem Saƒülƒ±ƒüƒ±</span>
                                    <strong id="diagHealth">--</strong>
                                    <small>ROS graph durumu</small>
                                </div>
                            </div>
                        </div>
                        <div class="panel-section">
                            <h2>‚öôÔ∏è Parametre Y√∂neticisi</h2>
                            <div class="control-group">
                                <input type="text" id="parameterNode" placeholder="Node adƒ± (√∂rn: teleop_panel)">
                                <input type="text" id="parameterKey" placeholder="Parametre adƒ± (√∂rn: max_speed)">
                                <input type="text" id="parameterValue" placeholder="Deƒüer (√∂rn: 0.5)">
                                <button onclick="addParameter()" class="btn-primary">Parametre Kaydet</button>
                            </div>
                            <ul id="parameterList" class="data-list"></ul>
                        </div>
                        <div class="panel-section">
                            <h2>üõ†Ô∏è Service Center</h2>
                            <div class="control-group">
                                <input type="text" id="serviceName" placeholder="Servis adƒ± (√∂rn: /reset_world)">
                                <input type="text" id="serviceType" placeholder="Tip (√∂rn: std_srvs/Trigger)">
                                <input type="text" id="serviceEndpoint" placeholder="Sim√ºle edilen endpoint a√ßƒ±klamasƒ±">
                                <button onclick="registerService()" class="btn-success">Servis Kaydet</button>
                            </div>
                            <div id="serviceList" class="service-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel -->
            <div class="center-panel">
                <div class="panel-section simulation-panel">
                    <div class="sim-header">
                        <div>
                            <h2>üõ∞Ô∏è 2D Sim√ºlasyon Alanƒ±</h2>
                            <p class="muted">Rust + WebAssembly + Canvas Pipeline</p>
                        </div>
                        <div class="sim-controls">
                            <select id="scenarioSelect" class="inline-select">
                                <option value="training">Teleop Eƒüitimi</option>
                                <option value="maze">Labirent At√∂lyesi</option>
                                <option value="warehouse">Depo &amp; Lojistik</option>
                            </select>
                            <button onclick="applyScenario()" class="btn-primary btn-small">Senaryoyu Y√ºkle</button>
                            <button onclick="toggleGrid()" id="gridToggleBtn" class="btn-small">Grid: A√ßƒ±k</button>
                            <button onclick="resetSimulator()" class="btn-danger btn-small">Reset</button>
                        </div>
                    </div>
                    <p class="scenario-description" id="scenarioDescription">Senaryo se√ßerek ba≈ülayƒ±n.</p>
                    <canvas id="simCanvas" width="1200" height="700"></canvas>
                    <div class="sim-info">
                        <span id="mousePos">Mouse: (0, 0)</span>
                        <span id="simMode">Mode: Normal</span>
                        <span id="activeScenario">Aktif Senaryo: -</span>
                    </div>
                    <div class="floating-toolbar">
                        <button class="btn-small" onclick="openCommandPalette()">Komut Paleti</button>
                        <button class="btn-small" onclick="activateTab('playbooks')">Hƒ±zlƒ± Komutlar</button>
                        <button class="btn-small" onclick="activateTab('topics')">Topic Y√∂netimi</button>
                    </div>
                </div>

                <div class="panel-grid">
                    <div class="panel-section telemetry-panel">
                        <h2>üìà Robot Telemetrisi</h2>
                        <p class="muted">Canvas √ºzerinde robot se√ßin ya da soldan bir robot se√ßin.</p>
                        <div class="telemetry-name" id="telemetryName">Robot se√ßilmedi</div>
                        <div class="telemetry-cards">
                            <div class="telemetry-card">
                                <span>Konum</span>
                                <strong id="telemetryPosition">x: -, y: -</strong>
                            </div>
                            <div class="telemetry-card">
                                <span>Y√∂n</span>
                                <strong id="telemetryHeading">0¬∞</strong>
                            </div>
                            <div class="telemetry-card">
                                <span>Linear</span>
                                <strong id="telemetryLinear">0 m/s</strong>
                            </div>
                            <div class="telemetry-card">
                                <span>Angular</span>
                                <strong id="telemetryAngular">0 rad/s</strong>
                            </div>
                        </div>
                        <button onclick="setVelocity(0, 0)" class="btn-info btn-small">Acil Dur</button>
                    </div>

                    <div class="panel-section world-panel">
                        <h2>üåç D√ºnya Durumu</h2>
                        <div class="world-summary">
                            <div class="world-card">
                                <span>Engeller</span>
                                <strong id="worldObstacle">0</strong>
                            </div>
                            <div class="world-card">
                                <span>Robotlar</span>
                                <strong id="worldRobots">0</strong>
                            </div>
                            <div class="world-card">
                                <span>Nodes</span>
                                <strong id="worldNodes">0</strong>
                            </div>
                        </div>
                        <p class="muted" id="worldDescription">Senaryo y√ºklenmesini bekleniyor.</p>
                        <button onclick="addObstacleMode()" class="btn-ghost btn-small">Engel Modu A√ß/Kapat</button>
                    </div>
                </div>

                <div class="panel-section rosgraph-panel">
                    <div class="section-header">
                        <h2>üï∏Ô∏è ROS Graph</h2>
                        <div class="legend">
                            <span class="legend-node">Node</span>
                            <span class="legend-topic">Topic</span>
                            <span class="legend-pub">Pub</span>
                            <span class="legend-sub">Sub</span>
                        </div>
                    </div>
                    <canvas id="rosGraph" width="900" height="320"></canvas>
                </div>

                <div class="panel-grid">
                    <div class="panel-section">
                        <h2>üì° Mesaj Monit√∂r√º</h2>
                        <div id="messageMonitor" class="message-monitor"></div>
                        <button onclick="clearMessages()" class="btn-small">Mesajlarƒ± Temizle</button>
                    </div>
                    <div class="panel-section console-panel">
                        <h2>üßæ Sistem Konsolu</h2>
                        <div id="systemConsole" class="console-output"></div>
                        <button onclick="clearConsole()" class="btn-small">Konsolu Temizle</button>
                    </div>
                    <div class="panel-section timeline-panel">
                        <h2>üß† Otomasyon Zaman √áizelgesi</h2>
                        <div id="automationTimeline" class="timeline"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Tutorials & Info -->
            <div class="right-panel">
                <div class="panel-section">
                    <h2>üéì Hƒ±zlƒ± Ba≈ülangƒ±√ß</h2>
                    <div class="tutorial-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>TurtleBot Ekle</h4>
                                <p>Sol panelden "turtle1" adƒ±nda bir TurtleBot olu≈üturun.</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Robotu Hareket Ettir</h4>
                                <p>Klavye kontrolleri (W,A,S,D) veya sliderlar ile robotu kontrol edin.</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Engeller Ekle</h4>
                                <p>Canvas'a tƒ±klayarak engeller olu≈üturun.</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>ROS2 Topics</h4>
                                <p>/cmd_vel topic'i ekleyip mesaj g√∂nderin.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üîß Robot Tipleri</h2>
                    <div class="robot-info">
                        <div class="robot-card">
                            <h4>üê¢ TurtleBot3</h4>
                            <p>Pop√ºler eƒüitim robotu. Differential drive kinematik.</p>
                            <ul>
                                <li>Max Linear: ¬±0.22 m/s</li>
                                <li>Max Angular: ¬±2.84 rad/s</li>
                            </ul>
                        </div>
                        <div class="robot-card">
                            <h4>‚öôÔ∏è Differential Drive</h4>
                            <p>ƒ∞ki tekerlekli sistem. Basit ve etkili.</p>
                            <ul>
                                <li>Sƒ±fƒ±r d√∂n√º≈ü yarƒ±√ßapƒ±</li>
                                <li>Y√ºksek manevra</li>
                            </ul>
                        </div>
                        <div class="robot-card">
                            <h4>üöó Ackermann</h4>
                            <p>Araba benzeri y√∂nlendirme sistemi.</p>
                            <ul>
                                <li>Ger√ßek√ßi hareket</li>
                                <li>Minimum d√∂n√º≈ü yarƒ±√ßapƒ±</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h2>üí° ƒ∞pu√ßlarƒ±</h2>
                    <ul class="tips-list">
                        <li>Robotlarƒ± s√ºr√ºkleyerek konumlarƒ±nƒ± g√ºncelleyebilirsiniz.</li>
                        <li>Grid a√ß/kapa ile ortamƒ± daha net inceleyin.</li>
                        <li>Mesajlar otomatik timestamp ile kaydedilir.</li>
                        <li>Klavye ile hƒ±zlƒ± kontrol: W/A/S/D/X</li>
                        <li>Node'larƒ± topic'lere baƒülayarak ROS graph'ƒ± olu≈üturun.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="commandPalette" class="command-palette hidden">
        <div class="palette-dialog">
            <div class="palette-header">
                <input type="text" id="paletteSearch" placeholder="Komut ara veya √ßalƒ±≈ütƒ±r (Ctrl+K)">
                <button id="paletteClose" class="btn-small">Kapat</button>
            </div>
            <div id="paletteResults" class="palette-results"></div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
